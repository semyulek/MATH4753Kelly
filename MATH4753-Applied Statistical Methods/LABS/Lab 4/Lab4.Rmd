---
title: "Lab4"
author: "Samuel Kelly"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Task 1

## Get Working Directory
```{r}
getwd()
```

# Task 2

## Read SPRUCE.csv
Read the .csv file and output the tail.
```{r}
spruce.df <- read.table("SPRUCE.csv", header = T, sep = ",")
tail(spruce.df)
```

# Task 3
## Trendscatter plot
Make a trendscatter plot with f=.5, of Height(m) vs BHDiameter(cm).
```{r}
library(s20x)
trendscatter(Height~BHDiameter,data = spruce.df,f = .5)
```

## Linear Model
Make the spruce linear model.
```{r}
spruce.lm = with(spruce.df, lm(Height~BHDiameter))
```

## Find Residuals
```{r}
height.res = residuals(spruce.lm)
```

## Find Fitted
```{r}
height.fit = fitted(spruce.lm)
```

## Plot Residuals vs. Fitted
```{r}
plot(height.res~height.fit)
```

## Plot Residuals vs. Fitted Using Trendscatter
```{r}
trendscatter(height.fit,height.res)
```

## What shape?
The trendscatter of residuals vs fitted clearly shows there is a curve. This curve is also observed in the first trendscatter plot that we plotted above. Side-by-side comparison.
```{r}
layout(matrix(1:2,nrow = 2,ncol = 1,byrow = F))
trendscatter(Height~BHDiameter,data = spruce.df,f = .5)
trendscatter(height.fit,height.res)
```

## Residual Plot
The linear model automatically prints out 4 different plots, so we must specify which one we want to use.
```{r}
plot(spruce.lm, which = 1)
```

## Normality
```{r}
normcheck(spruce.lm,shapiro.wilk = T)
```

## P-value, NULL Hypothesis
We should not reject the null hypothesis, since our p-value is .29, then our bell curve is distributed normally. P-value of .29 is not significant.

## Validity
To validate our claim then we must see that the height residuals mean equals 0. 
```{r}
round(mean(height.res),digits = 4)
```
When we look at the residuals vs fitted graph, we can see that the data curves and is not straight, so we should use a quadratic, since we need a curve with concavity.

# Task 4

## Quadratic
Square the x-value or BHDiameter, and leave it as is.
```{r}
quad.lm <- lm(Height~BHDiameter + I(BHDiameter^2),data = spruce.df)
plot(spruce.df$BHDiameter, spruce.df$Height, main = "Spruce Height vs. BHDiameter Prediction",
     xlab = "BHDiameter(cm)", ylab = "Height(m)", pch = 21, bg = "Blue", cex = 1.2,
     ylim = c(0, 1.1 * max(spruce.df$Height)), xlim = c(0, 1.1 * max(spruce.df$BHDiameter)))
```

## Add curve
```{r}
coef(quad.lm)
myplot = function(x){
  0.86089580 + 1.46959217*x -0.02745726*x^2
}
plot(spruce.df$BHDiameter, spruce.df$Height, main = "Spruce Height vs. BHDiameter Prediction",
     xlab = "BHDiameter(cm)", ylab = "Height(m)", pch = 21, bg = "Blue", cex = 1.2)
curve(myplot, lwd = 2, col = "steelblue", add = T)
```

## Alternative formula for calculating quadratic in R
```{r}
myplot2 = function(x){
  quad.lm$coef[1] + quad.lm$coef[2]*x + quad.lm$coef[3]*x^2
}
plot(spruce.df, main = "Spruce Height vs. BHDiameter Prediction",
     xlab = "BHDiameter(cm)", ylab = "Height(m)", pch = 21, bg = "Blue", cex = 1.2)
curve(myplot2, lwd = 2, col = "steelblue", add = T)
```

## Quad Fit
```{r}
quad.fit = fitted(quad.lm)
```

## Quadratic Residual vs Fitted
```{r}
plot(quad.lm, which = 1)
```

## Normcheck
```{r}
normcheck(quad.lm, shapiro.wilk = T)
```

## Validity
The P-value is .684 which suggests that we accept the null hypothesis, so the data is normally distributed.
We can conclude that the quadratic model fits better than the linear model we used in lab 3.

# Task 5

## Summary
```{r}
summary(quad.lm)
```

## Beta values
$$\hat{\beta}_{0} = 0.860896$$
$$\hat{\beta}_{1} = 1.469592 $$
$$\hat{\beta}_{2} = -0.027457$$

## Interval Beta estimates
This shows the z-scores for the upper and lower limits with a 95% accuracy.
```{r}
ciReg(quad.lm)
```

## Fitted Line Equation
$$Height = 0.860896 + 1.469592*x + (-0.027457)*x^2$$

## Prediction
```{r}
predict(quad.lm, data.frame(BHDiameter = c(15, 18, 20)))
```

## Comparison
```{r}
predict(spruce.lm, data.frame(BHDiameter = c(15, 18, 20)))
```
The values are overall larger in the quadratic prediction.

## R-Squared
```{r}
summary(spruce.lm)$r.squared
summary(quad.lm)$r.squared
```

## Adjusted R-Squared
```{r}
summary(spruce.lm)$adj.r.squared
summary(quad.lm)$adj.r.squared
```
The adjusted R-squared for the quadratic is higher than the linear model. Adjusted R-squared is a sort of accountability for adding too many variables that might have a chance correlation with your data, thus adjusted R-squared will decrease the more variables are added which do not correlate. Since our adjusted comparison for the quadratic is higher than the linear, we should use the quadratic.

## Multiple R-Squared
The multiple R-squared describes how good the models fit with the data.

## Variability
The higher the R-squared value that we can use can explain the variance in the data.
```{r}
summary(spruce.lm)$r.squared
summary(spruce.lm)$adj.r.squared
summary(quad.lm)$r.squared
summary(quad.lm)$adj.r.squared
```
Since the quadratic model is greater than the linear model, then it can explain the variance in height better than the linear model.

## Anova comparison
```{r}
anova(spruce.lm, quad.lm)
```
The smaller the residual sum of squares is, the better the data fits with the chosen model. In this case the quadratic model fits best with the data.

## RSS, MSS, TSS
```{r}
height.qfit = fitted(quad.lm)
(RSS = with(spruce.df, sum((Height - height.qfit)^2)))
(MSS = with(spruce.df, sum((height.qfit - mean(Height))^2)))
(TSS = with(spruce.df, sum((Height - mean(Height))^2)))
MSS/TSS
summary(quad.lm)$r.squared
```

# Task 6
