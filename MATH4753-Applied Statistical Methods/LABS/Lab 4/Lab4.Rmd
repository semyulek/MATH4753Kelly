---
title: "Lab4"
author: "Samuel Kelly"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Task 1

## Get Working Directory
```{r}
getwd()
```

# Task 2

## Read SPRUCE.csv
Read the .csv file and output the tail.
```{r}
spruce.df <- read.table("SPRUCE.csv", header = T, sep = ",")
tail(spruce.df)
```

# Task 3
## Trendscatter plot
Make a trendscatter plot with f=.5, of Height(m) vs BHDiameter(cm).
```{r}
library(s20x)
trendscatter(Height~BHDiameter,data = spruce.df,f = .5)
```

## Linear Model
Make the spruce linear model.
```{r}
spruce.lm = with(spruce.df, lm(Height~BHDiameter))
```

## Find Residuals
```{r}
height.res = residuals(spruce.lm)
```

## Find Fitted
```{r}
height.fit = fitted(spruce.lm)
```

## Plot Residuals vs. Fitted
```{r}
plot(height.res~height.fit)
```

## Plot Residuals vs. Fitted Using Trendscatter
```{r}
trendscatter(height.fit,height.res)
```

## What shape?
The trendscatter of residuals vs fitted clearly shows there is a curve. This curve is also observed in the first trendscatter plot that we plotted above. Side-by-side comparison.
```{r}
layout(matrix(1:2,nrow = 2,ncol = 1,byrow = F))
trendscatter(Height~BHDiameter,data = spruce.df,f = .5)
trendscatter(height.fit,height.res)
```

## Residual Plot
The linear model automatically prints out 4 different plots, so we must specify which one we want to use.
```{r}
plot(spruce.lm, which = 1)
```

## Normality
```{r}
normcheck(spruce.lm,shapiro.wilk = T)
```

## P-value, NULL Hypothesis
We should not reject the null hypothesis, since our p-value is .29, then our bell curve is distributed normally. P-value of .29 is not significant.

## Validity
To validate our claim then we must see that the height residuals mean equals 0. 
```{r}
round(mean(height.res),digits = 4)
```
When we look at the residuals vs fitted graph, we can see that the data curves and is not straight, so we should use a quadratic, since we need a curve with concavity.

# Task 4

## Quadratic
Square the x-value or BHDiameter, and leave it as is.
```{r}
quad.lm <- lm(Height~BHDiameter + I(BHDiameter^2),data = spruce.df)
plot(spruce.df$BHDiameter, spruce.df$Height, main = "Spruce Height vs. BHDiameter Prediction",
     xlab = "BHDiameter(cm)", ylab = "Height(m)", pch = 21, bg = "Blue", cex = 1.2,
     ylim = c(0, 1.1 * max(spruce.df$Height)), xlim = c(0, 1.1 * max(spruce.df$BHDiameter)))
```

## Add curve
```{r}
coef(quad.lm)
myplot = function(x){
  0.86089580 + 1.46959217*x -0.02745726*x^2
}
plot(spruce.df$BHDiameter, spruce.df$Height, main = "Spruce Height vs. BHDiameter Prediction",
     xlab = "BHDiameter(cm)", ylab = "Height(m)", pch = 21, bg = "Blue", cex = 1.2)
curve(myplot, lwd = 2, col = "steelblue", add = T)
```

## Alternative formula for calculating quadratic in R
```{r}
myplot2 = function(x){
  quad.lm$coef[1] + quad.lm$coef[2]*x + quad.lm$coef[3]*x^2
}
plot(spruce.df, main = "Spruce Height vs. BHDiameter Prediction",
     xlab = "BHDiameter(cm)", ylab = "Height(m)", pch = 21, bg = "Blue", cex = 1.2)
curve(myplot2, lwd = 2, col = "steelblue", add = T)
```

